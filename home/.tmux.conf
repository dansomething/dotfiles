# C-a should be the Tmux default prefix, really
set -g prefix C-a
unbind C-b
set -g mode-keys vi

# enable mouse features for terminals that support it
if-shell "[[ `tmux -V | cut -d ' ' -f2 | sed 's/[a\.]//g'` -ge 21 ]]" \
  'set -g mouse on;'
if-shell "[[ `tmux -V | cut -d ' ' -f2 | sed 's/[a\.]//g'` -lt 21 ]]" \
  'set -g mode-mouse on; \
   set -g mouse-utf8 on; \
   set -g mouse-resize-pane on; \
   set -g mouse-select-pane on; \
   set -g mouse-select-window on'

# enable 24-bit color
# http://sunaku.github.io/tmux-24bit-color.html#usage
set -ga terminal-overrides ",xterm-256color:Tc"
# https://github.com/neovim/neovim/wiki/FAQ#colors-arent-displayed-correctly
set -g default-terminal "xterm-256color"

# auto renumber windows as they are changed
set -g renumber-windows on

# Setup Environment (ensure ssh agent works across sessions and reconnections)
set -g update-environment "DISPLAY SSH_ASKPASS SSH_AGENT_PID SSH_CONNECTION WINDOWID XAUTHORITY"
set-environment -g SSH_AUTH_SOCK $HOME/.ssh/ssh-auth-sock.$HOSTNAME

# Open new splits in the current path
bind "\"" split-window -c '#{pane_current_path}'
bind "\%" split-window -h -c '#{pane_current_path}'

# Setup 'v' to begin selection as in Vim
if-shell "[[ `tmux -V | cut -d ' ' -f2 | sed 's/[a\.]//g'` -lt 24 ]]" \
  "bind-key -t vi-copy v begin-selection"
if-shell "[[ `tmux -V | cut -d ' ' -f2 | sed 's/[a\.]//g'` -ge 24 ]]" \
  "bind-key -T copy-mode-vi Escape send -X cancel; \
   bind-key -T copy-mode-vi 'v' send -X begin-selection"

# Dismiss current pane to background window
bind b break-pane -d
# Pane movement
bind-key j command-prompt -p "join pane from:"  "join-pane -h -s '%%'"
bind-key s command-prompt -p "send pane to:"  "join-pane -t '%%'"

# prefix + G searches for git commit SHA1.
set -g @copycat_search_G '\b[0-9a-f]{5,40}\b'

# status bar
source-file ~/.tmuxline.conf

# List of installed plugins by Tmux Plugin Manager (TPM)
# Supports `github_username/repo` or full git repo URLs
# Make sure to clone TPM before using `prefix + I` to install plugins
# git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
set -g @plugin 'Morantron/tmux-fingers'
set -g @plugin 'dansomething/vim-tmux-navigator'
set -g @plugin 'laktak/extrakto'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-logging'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tpm'

# Plugin configuration
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-processes ':all:'
set -g @extrakto_split_size '15'

# Initializes TMUX plugin manager.
# Keep this line at the very bottom of tmux.conf.
run -b '~/.tmux/plugins/tpm/tpm'
